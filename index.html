<!doctype html>
<html>
<head>
    <title>Neovis.js Simple Example</title>
    <style type="text/css">
        html, body {
            font: 16pt arial;
        }

       label {
            display: block;
            font: 1rem 'Fira Sans', sans-serif;
        }

        input,
        label {
            margin: .4rem 0;
        }

        #viz {
            width: 1500px;
            height: 1000px;
            border: 1px solid light-gray;
            //font: 22pt arial;
        }


        #iframe {

            position:fixed;
            right:70px;
            top:50px;
            }

			*{margin: 0;padding: 0;}
			.box{line-height: 40px;font-size: 16px;text-align: center;width: 280px;height: 320px; border: 1px #ccc solid;position: absolute;top: 50%;left: 50%;transform: translateX(-50%) translateY(-50%);color: #000;padding: 20px;}
			.top{font-size: 0;}
			.top button{width: 25%;display: inline-block;font-size: 16px;}
			.top #month{width: 50%;display: inline-block;font-size: 16px;}
			.evrday{width: 40px;height: 40px;float: left;}

    </style>

    <!-- FIXME: load from dist -->
    <script type="text/javascript" src="neovis.js"></script>

    <script scr="/npm/luxon@3.0.1/build/global/luxon.min.js"></script>

    <!-- Direct reference -->
<script src="lib/browser/neo4j-web.min.js"></script>

<!-- unpkg CDN non-minified -->
<script src="https://unpkg.com/neo4j-driver"></script>
<!-- unpkg CDN minified for production use, version X.Y.Z -->
<script src="https://unpkg.com/neo4j-driver@X.Y.Z/lib/browser/neo4j-web.min.js"></script>

<!-- jsDelivr CDN non-minified -->
<script src="https://cdn.jsdelivr.net/npm/neo4j-driver"></script>
<!-- jsDelivr CDN minified for production use, version X.Y.Z -->
<script src="https://cdn.jsdelivr.net/npm/neo4j-driver@X.Y.Z/lib/browser/neo4j-web.min.js"></script>

    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>

    <script type="text/javascript">
		// define config car
		// instantiate nodevis object
		// draw

		var viz;



		function draw() {

			var config = {


				containerId: "viz",
				neo4j: {
					serverUrl: "bolt://localhost:7687",
					serverUser: "neo4j",
					serverPassword: "Imran@2018"
				},
                visConfig:{
                    nodes: {
                        label:"name",
                        shape: "ellipse"
                        } ,
                    edges: {
                        arrows: {
                            to: {enabled: true}
                            }
                        },

                       },
				labels: {
					Climate_subjects: {
						label: "name",
						size: "pagerank",
						'color': 'red',
						group: "community",
						   [NeoVis.NEOVIS_ADVANCED_CONFIG]: {
							cypher: {
								value: "MATCH (n) WHERE id(n) = $id RETURN n.size"
							},
							function: {
								title: NeoVis.objectToTitleHtml
							},

						}

					},
					Climate_objects:{
					    label: "name",
						size: "pagerank",
						group:"community",
						[NeoVis.NEOVIS_ADVANCED_CONFIG]: {
							cypher: {
								value: "MATCH (n) WHERE id(n) = $id RETURN n.size"
							},
							function: {

								title: NeoVis.objectToTitleString
							},
						}

					}

				},
				relationships: {
					has: {
						value: "weight",
						[NeoVis.NEOVIS_ADVANCED_CONFIG]: {
							function: {
								title: NeoVis.objectToTitleHtml
							}
						}
					}
				},
				initialCypher: "MATCH (n)-[r:has]->(m) RETURN n,r,m LIMIT 50"


			};


			viz = new NeoVis.default(config);
			viz.render();

            console.log(this.viz);



            viz.registerOnEvent("completed", () => {
                //console.log("It is completed.");
                viz.network.on("click", (nodes) => {
                    //$("#newWin").html("");
                   //var cypher="MATCH p=()-[r:has]->() where r.date='May 12, 2022' RETURN p LIMIT 25";
                   //viz.UpdateWithCypher(cypher);

                    const container1 = document.getElementById('iframe').contentWindow.document;
                    //container1.insertAdjacentHTML('beforeend',$('.vis-tooltip').text().split("name:", -1));
                    document.getElementById('iframe').removeAttribute("hidden");
                    document.getElementById("iframe").style.visibility = "visible";
                    container1.open();
                    container1.write($('.vis-tooltip').text().split("name:", -1));
                    container1.close();


                    console.log($('.vis-tooltip').text().split(" "));

                });

            });

		}
    </script>
</head>

<body onload="draw()">
<label for="start">Start date:</label>

<input type="date" required pattern="[[a-z]+ [0-9]{2} [0-9]{4}]" onchange="displayDate()" id="start" name="trip-start">

<div id="viz"></div>
<div id="newWin"></div>
<iframe id="iframe" hidden></iframe>


Enter a climate label : <textarea rows="2" cols="50" id="climateLabel"></textarea>
<input type="submit" value="Submit-climate" id="submitClimate">



</body>

<script>

    function displayDate(){
        var dateVar = $("#start").val().toString();
        var date = $("#start").value;
        const newDate = new Date(dateVar);
        const options = {
            year: '2-digit',
            month: '2-digit',
            day: '2-digit',
            };
         const americanDateTime = new Intl.DateTimeFormat('en-US').format;

         console.log(dateVar);
         console.log(newDate.getYear());

         var cypher = "MATCH p=()-[r:has]->() where r.date='"  +dateVar+ "' RETURN p LIMIT 25";

         viz.renderWithCypher(cypher);

    }

    var driver = neo4j.driver(
    'bolt://localhost:7687',
    neo4j.auth.basic('neo4j', 'Imran@2018') );

    var session = driver.session();

	$("#reload").click(function () {

		var cypher = $("#cypher").val();

		if (cypher.length > 3) {
			viz.renderWithCypher(cypher);
		} else {
			console.log("reload");
			viz.reload();

		}

	});


	$("#stabilize").click(function () {
		viz.stabilize();
	});

	$("#submitClimate").click(function() {

	        var name1 = $("#climateLabel").val().toString();
            var name = document.getElementById("climateLabel").value;
            //var name = "Conservation";
            //const id = 25;
            var cypher = "MATCH (c:Climate_subjects{name:'"  +name+ "'})-[r:has]->(n) RETURN c,r,n LIMIT 25";
            //var cypher = "merge (n:param{value:name1}) with n.value as idParam1 MATCH (n)-[r:has]->(m) where n.name=idParam1 RETURN n,r,m";

            //var cypher= "merge (n:param{value:$idParam}) with n.value as idParam1 MATCH (p)-[r:has]->(m) WHERE id(p)=toInteger(idParam1) RETURN p,r,m";
            //var cypher= "MATCH (p)-[r:has]->(m) WHERE id(p)=$id RETURN p,r,m";

	        if(name1.length > 3) {
	            session.run(cypher,viz);
	            //viz.render(session.run(cypher));
	            viz.renderWithCypher(cypher);

	            console.log(name.toString());
	         } else {
			console.log("reload");
			viz.reload();

		}
	  })




</script>
</html>